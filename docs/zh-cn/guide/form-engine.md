---
title: 表单引擎
outline: [2, 3]
sort: 4
---

# 表单引擎

## 简介

用于快速开发复杂的表单类详情页面，主要由表单设计器和表单渲染器组成<br/>

表单设计器通过拖拽快速生成`JsonSchema`，后续表述中统称`表单模板`，表单渲染器使用 `JsonSchema` 渲染表单<br/>

基于[vue-form-craft](https://github.com/xinnian999/vue-form-craft)早期开源js版本重构，重构了大量代码，对一些边缘组件测试程度不够，不爱折腾的前端coder建议使用[vue-form-craft](https://github.com/xinnian999/vue-form-craft)的最新版本

## 表单管理

执行npm run dev启动项目后，在表单管理页面可管理项目中，可看到所有通过表单设计器生成的`JsonSchema`表单模板，同时支持新增表单模板、编辑基本信息、删除模板功能

![表单管理页](../../examples/form-engine/表单管理列表页.png)

::: danger 表单模板数据管理方式

1. 前端管理模板方式，模板的crud均通过操作本地Json文件实现，框架默认方式
2. 后端管理模板数据，模板数据存放在数据库

:::

**两种方式差异**

| 表单`JsonSchema`管理方式 | `JsonSchema`储存位置 | 优点 | 缺点 |
| :-- | :-- | :-- | :-- |
| 前端本地Json文件管理 | 打包到dist中，通过import导入到页面 | 直接管理模板内容，开发效率高，可采用全局查找替换等方式，批量调整模板 | 模板变动后，需要重新打包 |
| 后端接口 | 储存在后端数据库，通过接口获取 | 支持在线编辑，无需重新打包发布即可对所有用户生效 | 模板存放在数据库，开发阶段调整模板不便 |

### 新增表单

1. 普通新增

在表单管理页面，点击新增按钮，打开新增弹窗，填写如下信息

| 字段名   | 是否必填 | 描述                                                           |
| -------- | -------- | -------------------------------------------------------------- |
| 表单名称 | 是       | --                                                             |
| 所属菜单 | 是       | 通过菜单下拉项选择，与`表单路径`一起，组成唯一值，用于表单查找 |
| 表单路径 | 是       | 与`所属菜单`一起，组成唯一值，用于表单查找                     |
| mock路径 | 是       | 指定生成的json文件名                                           |
| 描述     | 否       | 用于添加表单备注                                               |

![表单新增弹窗](../../examples/form-engine/新增弹窗.png)

2. 快捷添加

在vue文件中，按如下方式使用`SimpleForm`组件，会看到`表单设计按钮`，点击进入后，若表单模板不存在，则会自动创建一个空白的表单

```vue
<template>
    <simple-form path="示例模板1" v-model="model"></simple-form>
</template>
<script lang="ts" setup>
const model = ref({})
</script>
```

### 设计表单

1. 在表单管理页面，点击设计按钮，进入表单设计页面
2. 在使用`SimpleForm`组件的页面，会看到`表单设计按钮`，点击进入表单设计页面

![表单设计页面](../../examples/form-engine/表单设计页面.png)

## 使用

### 基础用法

1. 设置表单的`routePath`、`path`属性，用于获取表单模板，当表单所在路由地址与`routePath`相同时，`routePath`可省略
2. 通过v-model双向绑定表单数据model，可在model中配置表单默认值，也可在model中获取表单最终值

::: tip 点击表单设计按钮可编辑模板，保存后查看效果

:::

::: details 点我查看示例

<demo vue="./src/views/demo示例合集/表单引擎示例合集/示例模板1.vue" />

:::

**模板讲解**

1. 下拉组件选项支持三种方式进行配置：本地、静态、远程。

    | 配置方式 | 配置方法 | 备注 |
    | --- | --- | --- |
    | 静态 | 在表单设计器处即可快速配置 | -- |
    | 本地 | 通过`{{}}双花括号插值表达式` 获取本地代码中，配置好的下拉选项 | -- |
    | 远程 | 配置请求地址(支持代理，无需完整地址)，请求方式，请求参数 | 支持通过属性面板`选项设置`中的`标签key`，`值Key`指定如何解析后端数据 |

2. 上传组件通过属性`储存字段`，将上传成功后的文件信息，同步到该属性指定的字段，本示例中，同步到了下方的`自增组件-表格`
3. 在组件配置面板中，配置`class`属性为`readonly`，即可使组件像`自增组件-表格`一样，变成只读状态
4. 对整个表单配置`readonly`，即可使整个表单只读，此时对单个组件配置`class`属性为`edit`，即可使该组件可编辑

### 插值表达式

或者又叫模板表达式，以双花括号 &lbrace;&lbrace; ... &rbrace;&rbrace; 为语法特征，对于字段间联动提供一种简洁的配置方式在JsonSchema中，被双花括号包裹的字符串一律会被解析为js表达式并返回结果，且可以使用一些联动变量

| 变量名      | 类型   | 描述                                                                |
| ----------- | ------ | ------------------------------------------------------------------- |
| $values     | Object | 整个表单的值（包含所有字段的完整数据）                              |
| $selectData | Object | 【选择类字段】选中项数据源合集（如下拉框、多选等组件的选项数据）    |
| $item       | Object | 【自增组件】专用，表示单行的数据值（用于表格/列表中的单行数据操作） |
| $index      | number | 【自增组件】专用，表示单行的下标（用于定位表格/列表中的当前行位置） |
| ...         | any    | 由schemaContext传入的自定义变量（可根据实际需求扩展的预留变量）     |

::: tip 自增组件值联动

1. 支持通过在目标字段前使用“\*”，批量更新列表某列数据
2. 行数据间联动，直接设置目标字段

:::

::: details 点我查看示例

<demo vue="./src/views/demo示例合集/表单引擎示例合集/示例模板2.vue" />

:::

### 外部事件

在schemaContext中传入自定义函数，通过模板表达式使用

::: tip 注意事项

1. 在自增组件中，当函数需要传参`$item`或者`$index`时，需要采用三元表达式的形式&lbrace;&lbrace; $item? ()=>function($index) : null &rbrace;&rbrace;
2. 在自增组件表格模式下，可以在FormList.vue文件中的`buttonHandle`方法里，自定义特殊事件（根据业务需要），默认提供了`delRow`事件，用于删除行数据，使用时，无需使用双花括号

:::

::: details 点我查看示例

<demo vue="./src/views/demo示例合集/表单引擎示例合集/示例模板3.vue" />

:::

### 只读与编辑状态

通过`readonly`与`edit`两个class样式控制，可实现在整个表单只读下，单独设置某个组件为编辑状态，也可在整个表单处于编辑状态，对某个组件设置只读状态，请查看下方示例，灵活使用。

某些未测试到的组件及自定义组件需要自行参照框架实现方式进行处理

::: tip

1. 面板属性中的只读与样式只读为不同效果
2. 某些情况下需要给包裹组件的`el-form-item`组件配置样式或者属性，此时，可从右侧配置面板下方的`编辑配置文本按钮`直接配置schemaJson，以下方配置举例，在props属性下的配置，是作用于组件本身，而与props同级的class属性作用于`el-form-item`

```json {5,8}
{
    "label": "名字长度",
    "component": "Input",
    "props": {
        "placeholder": "请输入文本",
        "class": "edit"
    },
    "class": "form-item-style",
    "designKey": "form-34KW",
    "name": "length",
    "labelAlign": "top"
}
```

:::

::: details 点我查看示例

<demo vue="./src/views/demo示例合集/表单引擎示例合集/示例模板4.vue" />

:::

### 其他事项

1. 栅格布局组件，通过自定义class来控制栅格布局，框架默认提供了`grid-style`样式，请自行按设计稿要求调整
2. 权限控制等功能，可以自行扩展组件的配置属性
3. 表单引擎的功能非常强大，完全能用于企业项目开发，未尽说明事项请自行从组件控制面板进行配置尝试
