{
  "name": "d3",
  "type": "directory",
  "children": [
    {
      "name": "bar",
      "type": "directory",
      "children": [
        {
          "name": "base.vue",
          "type": "file",
          "content": "<template>\r\n    <div :id=\"id\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport Chart from '@/d3/chart.ts'\r\nimport d3 from '@/d3/d3.js'\r\n\r\nconst props = defineProps({\r\n    id: {\r\n        required: true,\r\n        default: 'd3_svg_' + Math.floor(new Date().getTime() * Math.random()),\r\n    },\r\n    data: {\r\n        required: true,\r\n        default() {\r\n            return [\r\n                {\r\n                    date: '2025-01',\r\n                    value: 33,\r\n                },\r\n                {\r\n                    date: '2025-02',\r\n                    value: 13,\r\n                },\r\n                {\r\n                    date: '2025-03',\r\n                    value: 53,\r\n                },\r\n                {\r\n                    date: '2025-04',\r\n                    value: 83,\r\n                },\r\n                {\r\n                    date: '2025-05',\r\n                    value: 43,\r\n                },\r\n            ]\r\n        },\r\n    },\r\n    width: {},\r\n    height: {},\r\n    modelValue: {},\r\n})\r\n\r\nwatch(\r\n    props.data,\r\n    (value) => {\r\n        initMap(value)\r\n    },\r\n    { deep: true },\r\n)\r\n\r\nonMounted(() => {\r\n    initMap(props.data)\r\n})\r\nfunction initMap(data) {\r\n    const config = {\r\n        barPadding: 0.4,\r\n        barColor: '#296FFF7F',\r\n        textColor: '#303133',\r\n        gridColor: 'gray',\r\n        tickShowGrid: [60, 120, 180],\r\n        title: '基础柱状图',\r\n        hoverColor: '#296FFF',\r\n        animateDuration: 1000,\r\n    }\r\n\r\n    const chart = new Chart({\r\n        id: props.id,\r\n        margin: { top: 16, left: 40, bottom: 40, right: 15 },\r\n    })\r\n\r\n    /* ----------------------------尺度转换------------------------  */\r\n    chart.scaleX = d3\r\n        .scaleBand()\r\n        .domain(data.map((d) => d.date))\r\n        .range([0, chart.getBodyWidth()])\r\n        .padding(config.barPadding)\r\n\r\n    const maxValue = d3.max(data, (d) => d.value)\r\n\r\n    const minYMax = 5\r\n    let yMax = Math.max(minYMax, maxValue)\r\n    const numTicks = 5\r\n    // d3.ticks会返回“理想等距”刻度，覆盖数据区间\r\n    const ticks = d3.ticks(0, yMax, numTicks)\r\n    const tickMax = ticks[ticks.length - 1]\r\n    const tickDistance = ticks[1]\r\n    // 获取最靠上的刻度（最大刻度）\r\n    yMax = yMax > tickMax ? tickMax + tickDistance : tickMax\r\n\r\n    chart.scaleY = d3.scaleLinear().domain([0, yMax]).range([chart.getBodyHeight(), 0]).nice()\r\n\r\n    /* ----------------------------渲染柱形------------------------  */\r\n    chart.renderBars = function () {\r\n        const bars = chart.body().selectAll(`.${props.id}-bar`).data(data)\r\n\r\n        bars.enter()\r\n            .append('rect')\r\n            .attr('class', `${props.id}-bar`)\r\n            .classed('pointer', true)\r\n            .merge(bars)\r\n            .attr('x', (d) => chart.margin().left + chart.scaleX(d.date))\r\n            .attr('y', chart.margin().top + chart.scaleY(0))\r\n            .attr('width', chart.scaleX.bandwidth())\r\n            .attr('height', 0)\r\n            .attr('fill', config.barColor)\r\n            .transition()\r\n            .duration(config.animateDuration)\r\n            .attr('height', (d) => chart.getBodyHeight() - chart.scaleY(d.value))\r\n            .attr('y', (d) => chart.margin().top + chart.scaleY(d.value))\r\n\r\n        bars.exit().remove()\r\n    }\r\n\r\n    /* ----------------------------渲染坐标轴------------------------  */\r\n    chart.renderX = function () {\r\n        const xTick = d3\r\n            .axisBottom(chart.scaleX)\r\n            .tickSize(5) //刻度线尺寸\r\n            .tickPadding(10)\r\n            .tickFormat((d) => {\r\n                return parseInt(d)\r\n            })\r\n        const xAxis = chart\r\n            .svg()\r\n            .insert('g', '.body')\r\n            .attr(\r\n                'transform',\r\n                'translate(' + chart.margin().left + ',' + (chart.margin().top + chart.getBodyHeight()) + ')',\r\n            )\r\n            .attr('class', 'xAxis')\r\n            .call(xTick)\r\n\r\n        // xAxis.select('path').remove() //移除坐标轴中的横线\r\n        xAxis.selectAll('text').attr('opacity', 0.5).attr('style', 'font-size:8px')\r\n    }\r\n\r\n    chart.renderY = function () {\r\n        const yTick = d3.axisLeft(chart.scaleY).ticks(numTicks).tickSize(5).tickPadding(10)\r\n        const yAxis = chart\r\n            .svg()\r\n            .insert('g', '.body')\r\n            .attr('transform', 'translate(' + chart.margin().left + ',' + chart.margin().top + ')')\r\n            .attr('class', 'yAxis')\r\n            .call(yTick)\r\n\r\n        // yAxis.select('path').remove()\r\n        yAxis.selectAll('text').attr('opacity', 0.5).attr('style', 'font-size:8px')\r\n    }\r\n\r\n    chart.renderAxis = function () {\r\n        chart.renderX()\r\n        chart.renderY()\r\n    }\r\n\r\n    /* ----------------------------渲染文本标签------------------------  */\r\n    chart.renderText = function () {\r\n        d3.select('.xAxis')\r\n            .append('text')\r\n            .attr('class', 'axisText')\r\n            .attr('x', chart.getBodyWidth())\r\n            .attr('y', 0)\r\n            .attr('fill', config.textColor)\r\n            .attr('dy', 22)\r\n            .text('日期')\r\n\r\n        d3.select('.yAxis')\r\n            .append('text')\r\n            .attr('class', 'axisText')\r\n            .attr('x', 5)\r\n            .attr('y', 20)\r\n            .attr('fill', config.textColor)\r\n            .attr('transform', 'rotate(-90)')\r\n            .attr('dy', 0)\r\n            .attr('text-anchor', 'end')\r\n            .text('每日收入（元）')\r\n    }\r\n\r\n    /* ----------------------------渲染网格线------------------------  */\r\n    chart.renderGrid = function () {\r\n        d3.selectAll('.yAxis .tick').each(function () {\r\n            d3.select(this) //d3的回调this会指向当前dom\r\n                .append('line')\r\n                .attr('class', 'grid')\r\n                .attr('stroke', '#ecf4ff')\r\n                .attr('stroke-width', '1px')\r\n                .attr('x1', 0)\r\n                .attr('y1', 0)\r\n                .attr('x2', chart.getBodyWidth())\r\n                .attr('y2', 0)\r\n        })\r\n    }\r\n\r\n    /* ----------------------------渲染图标题------------------------  */\r\n    chart.renderTitle = function () {\r\n        chart\r\n            .svg()\r\n            .append('text')\r\n            .classed('title', true)\r\n            .attr('x', chart.width() / 2)\r\n            .attr('y', 0)\r\n            .attr('dy', '2em')\r\n            .text(config.title)\r\n            .attr('fill', config.textColor)\r\n            .attr('text-anchor', 'middle')\r\n    }\r\n\r\n    /* ----------------------------绑定鼠标交互事件------------------------  */\r\n    chart.addMouseOn = function () {\r\n        d3.selectAll(`.${props.id}-bar`)\r\n            .on('mouseover', function (d, i) {\r\n                const e = d3.event\r\n                const position = d3.mouse(chart.svg().node())\r\n                d3.select(e.target)\r\n                    .transition()\r\n                    .duration(config.animateDuration / 2)\r\n                    .attr('fill', config.hoverColor)\r\n\r\n                chart\r\n                    .svg()\r\n                    .append('text')\r\n                    .classed('tip', true)\r\n                    .attr('x', () => {\r\n                        let x = position[0] + 15\r\n                        if (i > props.dataLength / 2) {\r\n                            x = position[0] - 15\r\n                        }\r\n                        return x\r\n                    })\r\n                    .attr('y', position[1] - 10)\r\n                    .transition()\r\n                    .duration(config.animateDuration / 2)\r\n                    .attr('fill', config.textColor)\r\n                    .text(d.date + ' 销量:' + d.value)\r\n                    .attr('text-anchor', () => {\r\n                        let textAnchor = 'start'\r\n                        if (i > props.dataLength / 2) {\r\n                            textAnchor = 'end'\r\n                        }\r\n                        return textAnchor\r\n                    })\r\n            })\r\n            .on('mouseleave', function () {\r\n                const e = d3.event\r\n\r\n                d3.select(e.target)\r\n                    .transition()\r\n                    .duration(config.animateDuration / 2)\r\n                    .attr('fill', config.barColor)\r\n\r\n                d3.select('.tip').remove()\r\n            })\r\n            .on('mousemove', function (d, i) {\r\n                const position = d3.mouse(chart.svg().node())\r\n                d3.select('.tip')\r\n                    .attr('x', () => {\r\n                        let x = position[0] + 15\r\n                        if (i > props.dataLength / 2) {\r\n                            x = position[0] - 15\r\n                        }\r\n                        return x\r\n                    })\r\n                    .attr('y', position[1] - 10)\r\n            })\r\n            .on('click', function (d, i) {\r\n                props.$emit('update:modelValue', i)\r\n            })\r\n    }\r\n\r\n    chart.render = function () {\r\n        chart.renderAxis()\r\n\r\n        chart.renderText()\r\n\r\n        chart.renderGrid()\r\n\r\n        chart.renderBars()\r\n\r\n        chart.addMouseOn()\r\n\r\n        chart.renderTitle()\r\n    }\r\n\r\n    chart.render()\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n",
          "size": 9249,
          "encoding": "utf-8"
        }
      ]
    },
    {
      "name": "force",
      "type": "directory",
      "children": [
        {
          "name": "base-data.json",
          "type": "file",
          "content": "{\r\n    \"name\": \"当前项目\",\r\n    \"children\": [\r\n        {\r\n            \"name\": \"前置\",\r\n            \"children\": [\r\n                {\r\n                    \"name\": \"前置\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"house\": 2\r\n                        },\r\n                        {\r\n                            \"name\": \"并列\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"name\": \"后置\",\r\n                            \"house\": 4\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            \"name\": \"并列\",\r\n            \"children\": [\r\n                {\r\n                    \"name\": \"前置\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"name\": \"并列\",\r\n                            \"house\": 2\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    \"name\": \"并列\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            \"name\": \"后置\",\r\n            \"children\": [\r\n                {\r\n                    \"name\": \"前置\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\",\r\n                                    \"children\": [\r\n                                        {\r\n                                            \"name\": \"前置\"\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"name\": \"并列\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\",\r\n                                    \"children\": [\r\n                                        {\r\n                                            \"name\": \"前置\"\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    \"name\": \"并列\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"house\": 2\r\n                        },\r\n                        {\r\n                            \"name\": \"并列\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\",\r\n                                    \"children\": [\r\n                                        {\r\n                                            \"name\": \"前置\"\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"name\": \"后置\",\r\n                            \"house\": 2\r\n                        }\r\n                    ]\r\n                },\r\n                {\r\n                    \"name\": \"后置\",\r\n                    \"children\": [\r\n                        {\r\n                            \"name\": \"前置\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\",\r\n                                    \"children\": [\r\n                                        {\r\n                                            \"name\": \"前置\"\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"name\": \"并列\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"name\": \"前置\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        }\r\n    ]\r\n}\r\n",
          "size": 5221,
          "encoding": "utf-8"
        },
        {
          "name": "base.vue",
          "type": "file",
          "content": "<template>\r\n    <div :id=\"id\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport Chart from '@/d3/chart.ts'\r\nimport jsonData from './base-data.json'\r\n\r\nconst props = defineProps({\r\n    id: {\r\n        required: true,\r\n        default: 'd3_svg_' + Math.floor(new Date().getTime() * Math.random()),\r\n    },\r\n    data: {\r\n        required: true,\r\n        default: jsonData,\r\n    },\r\n    width: {},\r\n    height: {},\r\n    modelValue: {},\r\n})\r\n\r\nwatch(\r\n    props.data,\r\n    (value) => {\r\n        initMap(value)\r\n    },\r\n    { deep: true },\r\n)\r\n\r\nonMounted(() => {\r\n    initMap(props.data)\r\n})\r\nfunction initMap(data) {\r\n    const config = {\r\n        title: '力导向图',\r\n        lineColor: 'black',\r\n        lineWidth: '1',\r\n        pointSize: 8,\r\n        pointStroke: 'white',\r\n    }\r\n\r\n    const chart = new Chart({\r\n        id: props.id,\r\n        margins: { top: 80, left: 80, bottom: 50, right: 80 },\r\n    })\r\n\r\n    /* ----------------------------处理数据------------------------  */\r\n    const root = d3.hierarchy(data)\r\n\r\n    const nodes = root.descendants()\r\n\r\n    const links = root.links()\r\n\r\n    /* ----------------------------建立力模型------------------------  */\r\n    const force = d3\r\n        .forceSimulation()\r\n        .velocityDecay(0.8) //速度衰减\r\n        .alphaDecay(0) //alpha衰变, 0表示不衰减\r\n        .force('charge', d3.forceManyBody()) //节点相互作用力，默认为斥力-30\r\n        .force('collision', d3.forceCollide(config.pointSize + 0.2).strength(0.1)) //碰撞\r\n        .force('center', d3.forceCenter(chart.width() / 2, chart.height() / 2)) //定义力模型坐标的中心点\r\n\r\n    force.nodes(nodes) //绑定节点\r\n\r\n    force.force('link', d3.forceLink(links).strength(1).distance(20)) //绑定节点间链接\r\n\r\n    /* ----------------------------渲染图标题------------------------  */\r\n    chart.renderTitle = function () {\r\n        chart\r\n            .svg()\r\n            .append('text')\r\n            .classed('title', true)\r\n            .attr('x', chart.width() / 2)\r\n            .attr('y', 0)\r\n            .attr('dy', '2em')\r\n            .text(config.title)\r\n            .attr('fill', config.textColor)\r\n            .attr('text-anchor', 'middle')\r\n            .attr('stroke', config.textColor)\r\n    }\r\n\r\n    /* ----------------------------渲染节点------------------------  */\r\n    chart.renderNodes = function () {\r\n        const points = chart.body().selectAll('circle').data(nodes)\r\n\r\n        points\r\n            .enter()\r\n            .append('circle')\r\n            .attr('r', config.pointSize)\r\n            .attr('fill', (d) => chart._colors(d.depth % 10))\r\n            .attr('stroke', config.pointStroke)\r\n\r\n        points\r\n            .exit()\r\n            .transition()\r\n            .attr('r', 1e-6)\r\n            .on('end', (d) => {\r\n                //删除点，并重新绑定nodes\r\n                nodes.splice(nodes.indexOf(d), 1)\r\n                force.nodes(nodes)\r\n            })\r\n            .remove()\r\n    }\r\n\r\n    /* ----------------------------渲染节点连线------------------------  */\r\n    chart.renderLinks = function () {\r\n        const lines = chart.body().selectAll('line').data(links)\r\n\r\n        lines.enter().insert('line', 'circle').attr('stroke', config.lineColor).attr('stroke-width', config.lineWidth)\r\n\r\n        lines\r\n            .exit()\r\n            .transition()\r\n            .on('end', (d) => {\r\n                //删除线，并重新绑定links\r\n                links.splice(links.indexOf(d), 1)\r\n                force.force('link', d3.forceLink(links).strength(1).distance(20))\r\n                force.restart()\r\n            })\r\n            .remove()\r\n    }\r\n\r\n    /* ----------------------------绑定鼠标交互事件------------------------  */\r\n    chart.addMouseOn = function () {\r\n        const drag = d3\r\n            .drag()\r\n            .on('start', (d) => {\r\n                d.fx = d.x\r\n                d.fy = d.y\r\n            })\r\n            .on('drag', (d) => {\r\n                d.fx = d3.event.x\r\n                d.fy = d3.event.y\r\n            })\r\n            .on('end', (d) => {\r\n                d.fx = null\r\n                d.fy = null\r\n            })\r\n\r\n        chart.body().selectAll('circle').call(drag)\r\n    }\r\n\r\n    /* ----------------------------绑定tick事件------------------------  */\r\n    chart.addForceTick = function () {\r\n        force.on('tick', function () {\r\n            chart\r\n                .body()\r\n                .selectAll('line')\r\n                .attr('x1', (d) => d.source.x)\r\n                .attr('y1', (d) => d.source.y)\r\n                .attr('x2', (d) => d.target.x)\r\n                .attr('y2', (d) => d.target.y)\r\n\r\n            chart\r\n                .body()\r\n                .selectAll('circle')\r\n                .attr('cx', (d) => d.x)\r\n                .attr('cy', (d) => d.y)\r\n        })\r\n    }\r\n\r\n    chart.render = function () {\r\n        chart.renderTitle()\r\n\r\n        chart.renderNodes()\r\n\r\n        chart.renderLinks()\r\n\r\n        chart.addMouseOn()\r\n\r\n        chart.addForceTick()\r\n    }\r\n\r\n    chart.render()\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n",
          "size": 5129,
          "encoding": "utf-8"
        },
        {
          "name": "link-arrow-data.json",
          "type": "file",
          "content": "{\r\n    \"nodes\": [\r\n        {\r\n            \"id\": 321\r\n        },\r\n        {\r\n            \"id\": 366\r\n        },\r\n        {\r\n            \"id\": 300\r\n        },\r\n        {\r\n            \"id\": 380\r\n        },\r\n        {\r\n            \"id\": 312\r\n        },\r\n        {\r\n            \"id\": 332\r\n        },\r\n        {\r\n            \"id\": 341\r\n        },\r\n        {\r\n            \"id\": 343\r\n        },\r\n        {\r\n            \"id\": 346\r\n        },\r\n        {\r\n            \"id\": 351\r\n        },\r\n        {\r\n            \"id\": 352\r\n        },\r\n        {\r\n            \"id\": 353\r\n        },\r\n        {\r\n            \"id\": 358\r\n        },\r\n        {\r\n            \"id\": 359\r\n        },\r\n        {\r\n            \"id\": 383\r\n        },\r\n        {\r\n            \"id\": 319\r\n        },\r\n        {\r\n            \"id\": 364\r\n        },\r\n        {\r\n            \"id\": 333\r\n        },\r\n        {\r\n            \"id\": 357\r\n        },\r\n\r\n        {\r\n            \"id\": 374\r\n        },\r\n        {\r\n            \"id\": 378\r\n        }\r\n    ],\r\n    \"links\": [\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 366\r\n        },\r\n        {\r\n            \"source\": 300,\r\n            \"target\": 321\r\n        },\r\n\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 380\r\n        },\r\n        {\r\n            \"source\": 380,\r\n            \"target\": 312\r\n        },\r\n\r\n        {\r\n            \"target\": 321,\r\n            \"source\": 332,\r\n            \"type\": \"并列\"\r\n        },\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 341\r\n        },\r\n\r\n        {\r\n            \"source\": 341,\r\n            \"target\": 343\r\n        },\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 346\r\n        },\r\n\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 351\r\n        },\r\n        {\r\n            \"source\": 351,\r\n            \"target\": 352,\r\n            \"type\": \"并列\"\r\n        },\r\n\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 353\r\n        },\r\n        {\r\n            \"source\": 353,\r\n            \"target\": 358\r\n        },\r\n\r\n        {\r\n            \"target\": 359,\r\n            \"source\": 321\r\n        },\r\n        {\r\n            \"target\": 383,\r\n            \"source\": 359\r\n        },\r\n\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 364\r\n        },\r\n        {\r\n            \"target\": 351,\r\n            \"source\": 333\r\n        },\r\n        {\r\n            \"source\": 321,\r\n            \"target\": 357\r\n        },\r\n        {\r\n            \"source\": 319,\r\n            \"target\": 357,\r\n            \"type\": \"并列\"\r\n        },\r\n        {\r\n            \"source\": 300,\r\n            \"target\": 374\r\n        },\r\n\r\n        {\r\n            \"source\": 378,\r\n            \"target\": 321\r\n        }\r\n    ]\r\n}\r\n",
          "size": 2688,
          "encoding": "utf-8"
        },
        {
          "name": "link-arrow.vue",
          "type": "file",
          "content": "<template>\r\n    <div :id=\"id\" class=\"relative\">\r\n        <div v-show=\"showMark\" class=\"p-a lf0 tp0 z9 h-full w-full\"></div>\r\n        <svg style=\"position: absolute; width: 0px; height: 0px\">\r\n            <defs>\r\n                <marker\r\n                    id=\"fore-marker-yellow\"\r\n                    markerWidth=\"6\"\r\n                    markerHeight=\"10\"\r\n                    refX=\"26\"\r\n                    refY=\"5\"\r\n                    orient=\"auto\"\r\n                    color=\"#FFCD2A\">\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(-1 1) rotate(-45 2.97 9.73)\"\r\n                        fill=\"currentColor\" />\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(1 -1) rotate(45 12.48 -3.67)\"\r\n                        fill=\"currentColor\" />\r\n                </marker>\r\n                <marker\r\n                    id=\"fore-marker-start-yellow\"\r\n                    markerWidth=\"6\"\r\n                    markerHeight=\"10\"\r\n                    refX=\"26\"\r\n                    refY=\"5\"\r\n                    orient=\"auto-start-reverse\"\r\n                    color=\"#FFCD2A\">\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(-1 1) rotate(-45 2.97 9.73)\"\r\n                        fill=\"currentColor\" />\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(1 -1) rotate(45 12.48 -3.67)\"\r\n                        fill=\"currentColor\" />\r\n                </marker>\r\n                <marker\r\n                    id=\"fore-marker-blue\"\r\n                    markerWidth=\"6\"\r\n                    markerHeight=\"10\"\r\n                    refX=\"26\"\r\n                    refY=\"5\"\r\n                    orient=\"auto\"\r\n                    color=\"#BEE3FF\">\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(-1 1) rotate(-45 2.97 9.73)\"\r\n                        fill=\"currentColor\" />\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(1 -1) rotate(45 12.48 -3.67)\"\r\n                        fill=\"currentColor\" />\r\n                </marker>\r\n                <marker\r\n                    id=\"fore-marker-gray\"\r\n                    markerWidth=\"6\"\r\n                    markerHeight=\"10\"\r\n                    refX=\"26\"\r\n                    refY=\"5\"\r\n                    orient=\"auto\"\r\n                    color=\"#B3B3B3\">\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(-1 1) rotate(-45 2.97 9.73)\"\r\n                        fill=\"currentColor\" />\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(1 -1) rotate(45 12.48 -3.67)\"\r\n                        fill=\"currentColor\" />\r\n                </marker>\r\n                <marker\r\n                    id=\"fore-marker-start-gray\"\r\n                    markerWidth=\"6\"\r\n                    markerHeight=\"10\"\r\n                    refX=\"26\"\r\n                    refY=\"5\"\r\n                    orient=\"auto-start-reverse\"\r\n                    color=\"#B3B3B3\">\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(-1 1) rotate(-45 2.97 9.73)\"\r\n                        fill=\"currentColor\" />\r\n                    <rect\r\n                        rx=\".75\"\r\n                        width=\"7\"\r\n                        height=\"1.5\"\r\n                        transform=\"scale(1 -1) rotate(45 12.48 -3.67)\"\r\n                        fill=\"currentColor\" />\r\n                </marker>\r\n            </defs>\r\n        </svg>\r\n        <div class=\"z8 rounded-2 v-between-center absolute right-5 bottom-5 bg-white pr-2 pl-2\">\r\n            <el-button\r\n                type=\"info\"\r\n                text\r\n                v-for=\"item in icons\"\r\n                :key=\"item.name\"\r\n                class=\"!m0 !p0 w-full\"\r\n                v-ell:l-a=\"item.help\"\r\n                @click=\"item.action\"\r\n                style=\"height: 40px; color: #606266\">\r\n                <svg-icon\r\n                    class=\"font-size-6\"\r\n                    :name=\"\r\n                        'links-' + (item.name === 'full-screen' && isFull ? 'exit-' + item.name : item.name)\r\n                    \"></svg-icon>\r\n            </el-button>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"tsx\">\r\nimport Chart from '@/d3/chart.ts'\r\nimport { cloneDeep } from 'lodash-es'\r\nimport { ProjectRelateType } from '@/enums'\r\nimport { render } from 'vue'\r\nimport { ElPopover } from 'element-plus'\r\nimport jsonData from './link-arrow-data.json'\r\n\r\nconst showMark = ref()\r\nconst props = defineProps({\r\n    id: {\r\n        required: true,\r\n        default: 'd3_svg_' + Math.floor(new Date().getTime() * Math.random()),\r\n    },\r\n    data: {\r\n        required: true,\r\n        default: jsonData,\r\n    },\r\n    modelValue: {},\r\n})\r\n\r\nconst maxScale = 5\r\nconst minScale = 0.3\r\nconst icons = ref([\r\n    {\r\n        name: 'position',\r\n        action: position,\r\n        help: $t('d3.positionTip'),\r\n    },\r\n    {\r\n        name: 'refresh',\r\n        action: refresh,\r\n        help: $t('d3.refreshTip'),\r\n    },\r\n    {\r\n        name: 'add',\r\n        action: add,\r\n        help: $t('d3.addTip'),\r\n    },\r\n    {\r\n        name: 'subtract',\r\n        action: subtract,\r\n        help: $t('d3.subtractTip'),\r\n    },\r\n])\r\nconst manualZoom = ref()\r\nconst moving = ref(false)\r\nconst manualPosition = ref()\r\nconst currentNodeId = ref()\r\nconst currentNode = ref()\r\n\r\nconst originId = ref()\r\nconst config = {\r\n    title: '带箭头力导图',\r\n    lineColor: '#B3B3B3',\r\n    lineWidth: '1',\r\n    radius: 20,\r\n    pointStroke: 'white',\r\n    //以下属性为newChart必\r\n    id: props.id,\r\n    margins: { top: 80, left: 80, bottom: 50, right: 80 },\r\n    colors: ['#FFCD2A', '#BEE3FF', '#E7E7E7'],\r\n}\r\nwatch(\r\n    props.data,\r\n    (value) => {\r\n        initMap(value)\r\n    },\r\n    { deep: true },\r\n)\r\n\r\nonMounted(() => {\r\n    currentNodeId.value = props.modelValue\r\n    originId.value = props.modelValue\r\n    initMap(cloneDeep(props.data))\r\n})\r\n\r\n//解决突然切换导航栏时,d.creatPop()执行失败,导致提示窗未能及时关闭的问题\r\nonDeactivated(() => {\r\n    if (currentNode.value) {\r\n        document.querySelector('.link-popover-box-' + currentNode.value.id).parentElement.style.display = 'none'\r\n        currentNode.value = null\r\n    }\r\n})\r\n\r\nfunction refresh() {\r\n    currentNodeId.value = originId.value\r\n    const node = d3.select(`#node-box${currentNodeId.value}`)\r\n\r\n    const translateStr = node.attr('transform')\r\n    const { x, y } = getTransform(translateStr)\r\n    manualPosition.value({ x, y })\r\n\r\n    initNodeSelect()\r\n}\r\nfunction position() {\r\n    const node = d3.select(`#node-box${currentNodeId.value}`)\r\n\r\n    const translateStr = node.attr('transform')\r\n    const { x, y } = getTransform(translateStr)\r\n    manualPosition.value({ x, y })\r\n}\r\nfunction add() {\r\n    manualZoom.value('add')\r\n}\r\n\r\nfunction subtract() {\r\n    // scale.value -= 1\r\n    manualZoom.value('subtract')\r\n}\r\n\r\nfunction getTransform(translateStr) {\r\n    if (!translateStr) {\r\n        return {\r\n            x: 0,\r\n            y: 0,\r\n            k: 1,\r\n        }\r\n    }\r\n    const obj = {}\r\n    const regex = /translate\\((-?\\d+.?\\d*),\\s*(-?\\d+.?\\d*)\\)/\r\n    const match = translateStr.match(regex)\r\n    if (match) {\r\n        obj.x = +match[1] // 第一个捕获组，转换为数字\r\n        obj.y = +match[2] // 第二个捕获组，转换为数字\r\n    }\r\n    return obj\r\n}\r\n\r\nfunction setPopover() {\r\n    let d = this\r\n    currentNode.value = d\r\n\r\n    const container = document.querySelector('#popover-' + d.id)\r\n\r\n    const dom = (\r\n        <ElPopover visible={d.visible} width={40}>\r\n            {{\r\n                reference: () => {\r\n                    return (\r\n                        <div class=\"h-center-center h-full w-full rounded-full\" style=\"background:currentColor\">\r\n                            <div class=\"text-align-center !color-gray-6\">{d.id}</div>\r\n                        </div>\r\n                    )\r\n                },\r\n                default: () => {\r\n                    return (\r\n                        <div\r\n                            onMouseenter={() => domMouseenter()}\r\n                            onMouseleave={() => domMouseleave()}\r\n                            class=\"link-popover-box\"\r\n                            class={'link-popover-box-' + d.id}>\r\n                            <div\r\n                                class=\"text-4\"\r\n                                class={{ 'color-blue': d.displayFlag != 1, pointer: d.displayFlag != 1 }}>\r\n                                节点id：{d.id}\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                },\r\n            }}\r\n        </ElPopover>\r\n    )\r\n\r\n    if (dom && container) {\r\n        render(dom, container)\r\n    }\r\n\r\n    function domMouseenter() {\r\n        d.visible = true\r\n    }\r\n    function domMouseleave() {\r\n        d.visible = false\r\n        setTimeout(() => {\r\n            d.createPop()\r\n        }, 500)\r\n    }\r\n}\r\n\r\nfunction initMap(data) {\r\n    const chart = new Chart({\r\n        id: config.id,\r\n        margins: config.margins,\r\n        colors: config.colors,\r\n    })\r\n\r\n    /* ----------------------------处理数据------------------------  */\r\n    const nodes = data.nodes\r\n    const links = data.links\r\n\r\n    nodes.forEach((item) => {\r\n        if (props.modelValue === item.id && nodes.length > 5) {\r\n            //当节点数量非常少时,固定该节点会导致节点分布不均匀,出现节点重叠现象\r\n            item.fx = chart.width() / 2\r\n            item.fy = chart.height() / 2\r\n        }\r\n    })\r\n\r\n    /* ----------------------------建立力模型------------------------  */\r\n    const force = d3\r\n        .forceSimulation()\r\n        .velocityDecay(0.8) //速度衰减\r\n        .alphaDecay(0.04) //alpha衰变, 0表示不衰减\r\n        .force('collide', d3.forceCollide().radius(50).strength(1))\r\n        .force('charge', d3.forceManyBody().strength(-30)) //节点相互作用力，默认为-30斥力，设置为正数则为引力\r\n        .force('center', d3.forceCenter(chart.width() / 2, chart.height() / 2)) //定义力模型坐标的中心点\r\n\r\n    /**在 d3 的力导图中，连线和节点是通过连线数据里的 source 与 target 属性关联到节点数据的。\r\n     * 关联规则由 d3.forceLink(...).id(...) 决定：\r\n     *  id 访问器返回的值用于把 source/target 和 nodes 匹配。默认用节点的 index。*/\r\n    force.nodes(nodes) //绑定节点\r\n\r\n    force.force(\r\n        'link',\r\n        d3\r\n            .forceLink(data.links)\r\n            .id((d) => d.id)\r\n            .strength(1)\r\n            .distance(100),\r\n    )\r\n    //绑定节点间链接\r\n\r\n    /* ----------------------------渲染图标题------------------------  */\r\n    function renderTitle() {\r\n        chart\r\n            .svg()\r\n            .append('text')\r\n            .classed('title', true)\r\n            .attr('x', chart.width() / 2)\r\n            .attr('y', 0)\r\n            .attr('dy', '2em')\r\n            .text(config.title)\r\n            .attr('fill', config.textColor)\r\n            .attr('text-anchor', 'middle')\r\n            .attr('stroke', config.textColor)\r\n    }\r\n\r\n    /* ----------------------------渲染节点------------------------  */\r\n    function renderNodes() {\r\n        const points = chart.body().append('g').classed('node-box-group', true).selectAll('g').data(nodes)\r\n\r\n        const group = points\r\n            .enter()\r\n            .append('g')\r\n            .attr('id', (d) => 'node-box' + d.id)\r\n            .classed('node-box', true)\r\n            .attr('color', (d, i) => config.colors[2])\r\n\r\n        group\r\n            .append('foreignObject')\r\n            .attr('x', -config.radius)\r\n            .attr('y', -config.radius)\r\n            .attr('width', config.radius * 2)\r\n            .attr('height', config.radius * 2)\r\n            .attr('id', (d) => {\r\n                return 'popover-' + d.id\r\n            })\r\n            .each((d, i) => {\r\n                d.visible = false\r\n                d.createPop = setPopover\r\n                d.createPop(config.colors[2])\r\n            })\r\n\r\n        points.exit().remove()\r\n    }\r\n\r\n    /* ----------------------------渲染节点连线------------------------  */\r\n    function renderLinks() {\r\n        const lines = chart\r\n            .body()\r\n            .insert('g', 'g.node-box-group')\r\n            .attr('class', 'line-box')\r\n            .selectAll('line')\r\n            .data(links)\r\n\r\n        lines\r\n            .enter()\r\n            .append('line')\r\n            .attr('stroke', config.lineColor)\r\n            .attr('stroke-width', config.lineWidth)\r\n            .attr('marker-end', 'url(#fore-marker-gray)')\r\n            .attr('marker-start', (d) => {\r\n                return d.type === '并列' ? 'url(#fore-marker-start-gray)' : null\r\n            })\r\n\r\n        lines\r\n            .exit()\r\n            .transition()\r\n            .on('end', (d) => {\r\n                //删除线，并重新绑定links\r\n                links.splice(links.indexOf(d), 1)\r\n                force.force('link', d3.forceLink(links).strength(1).distance(200))\r\n                force.restart()\r\n            })\r\n            .remove()\r\n    }\r\n\r\n    /* ----------------------------渲染节点连线文本------------------------  */\r\n    function renderLinkTexts() {\r\n        const group = chart\r\n            .body()\r\n            .insert('g', 'g.node-box-group')\r\n            .attr('class', 'line-text-box')\r\n            .selectAll('text')\r\n            .data(links)\r\n\r\n        group\r\n            .enter()\r\n            .append('text')\r\n            .attr('text-anchor', 'middle')\r\n            .attr('font-size', 12)\r\n            .attr('fill', '#606266')\r\n            .classed('color-gray-6', true)\r\n            .attr('dy', -5)\r\n            .attr('opacity', 0)\r\n    }\r\n\r\n    /* ----------------------------绑定鼠标交互事件------------------------  */\r\n    function addNodeMouseOn() {\r\n        const drag = d3\r\n            .drag()\r\n            .on('start', (d) => {\r\n                console.log('start')\r\n                //开启拖拽后,mousedown失效,start事件生效\r\n                moving.value = true\r\n                d.visible = false\r\n                d.createPop()\r\n                d.fx = d.x\r\n                d.fy = d.y\r\n                // force.alphaMin(0.001).restart()\r\n                force.alphaTarget(0.002) //该值大于end后设置的值,可解决拖拽过程中力导图突然停止仿真问题\r\n\r\n                force.restart()\r\n            })\r\n            .on('drag', (d) => {\r\n                d.fx = d3.event.x\r\n                d.fy = d3.event.y\r\n            })\r\n            .on('end', (d) => {\r\n                force.alphaTarget(0.001)\r\n                d.fx = null\r\n                d.fy = null\r\n                force.alphaDecay(0.01).velocityDecay(0.4).alpha(0.01).alphaMin(0.0015).restart()\r\n                moving.value = false\r\n            })\r\n\r\n        chart.body().selectAll('g.node-box').call(drag)\r\n        // 绑定点击事件\r\n\r\n        chart\r\n            .svg()\r\n            .on('click', () => {\r\n                // 修改连接节点的颜色\r\n                chart.body().selectAll('g.node-box').attr('color', config.colors[2])\r\n\r\n                chart\r\n                    .body()\r\n                    .selectAll('line')\r\n                    .style('stroke', config.lineColor)\r\n                    .attr('marker-end', 'url(#fore-marker-gray)')\r\n                    .attr('marker-start', (d) => {\r\n                        if (d.type === '并列') {\r\n                            return 'url(#fore-marker-start-gray)'\r\n                        }\r\n                        return null\r\n                    })\r\n                chart.body().selectAll('g.line-text-box > text').attr('opacity', 0)\r\n            })\r\n            .on('mousedown', () => {\r\n                moving.value = true\r\n                const selection = window.getSelection()\r\n                selection.removeAllRanges()\r\n            })\r\n            .on('mouseup', () => {\r\n                moving.value = false\r\n            })\r\n\r\n        chart\r\n            .body()\r\n            .selectAll('g.node-box')\r\n            .on('mouseenter', (d) => {\r\n                if (!moving.value) {\r\n                    d.visible = true\r\n                    d.createPop()\r\n                }\r\n            })\r\n            .on('mouseleave', (d) => {\r\n                d.visible = false\r\n                setTimeout(() => {\r\n                    d.createPop()\r\n                }, 500)\r\n            })\r\n            // .on('mousedown', (d) => {\r\n            //     d.visible = false\r\n            //     d.createPop()\r\n            // })\r\n            .on('click', (d) => {\r\n                d.visible = false\r\n                d3.event.stopPropagation()\r\n                const nodeId = d.id\r\n                currentNodeId.value = nodeId\r\n                /**\r\n                 * 现阶段选中节点不更新下方列表\r\n                 */\r\n                // emits('select', d)\r\n\r\n                // 根据节点ID找到所有相关的连线\r\n                const connectedNodes = new Map()\r\n\r\n                links.forEach((link) => {\r\n                    if (link.source.id === nodeId || link.target.id === nodeId) {\r\n                        connectedNodes.set(link.source.id, true)\r\n                        connectedNodes.set(link.target.id, true)\r\n                    }\r\n                })\r\n\r\n                // 修改这些连线的颜色\r\n                chart\r\n                    .body()\r\n                    .selectAll('line')\r\n                    .style('stroke', (d) => {\r\n                        if (d.target.id === nodeId || d.source.id === nodeId) {\r\n                            return config.colors[0]\r\n                        }\r\n                        return config.lineColor\r\n                    })\r\n                    .attr('marker-end', (d) => {\r\n                        if (d.target.id === nodeId || d.source.id === nodeId) {\r\n                            return 'url(#fore-marker-yellow)'\r\n                        }\r\n                        return 'url(#fore-marker-gray)'\r\n                    })\r\n                    .attr('marker-start', (d) => {\r\n                        if (d.type === '并列') {\r\n                            if (d.target.id === nodeId || d.source.id === nodeId) {\r\n                                return 'url(#fore-marker-start-yellow)'\r\n                            }\r\n                            return 'url(#fore-marker-start-gray)'\r\n                        }\r\n                        return null\r\n                    })\r\n\r\n                // 修改连接节点的颜色\r\n                chart\r\n                    .body()\r\n                    .selectAll('g.node-box')\r\n                    .attr('color', (d) => {\r\n                        let result = config.colors[2]\r\n                        if (connectedNodes.get(d.id)) {\r\n                            result = config.colors[1]\r\n                        }\r\n                        if (d.id === nodeId) {\r\n                            result = config.colors[0]\r\n                        }\r\n                        return result\r\n                    })\r\n\r\n                // 修改连接线上的文字透明度\r\n                chart\r\n                    .body()\r\n                    .selectAll('g.line-text-box > text')\r\n                    .attr('opacity', (d) => {\r\n                        if (d.source.id === nodeId || d.target.id === nodeId) {\r\n                            return 1\r\n                        }\r\n                        return 0\r\n                    })\r\n                    .text((d) => {\r\n                        if (d.type === '并列') {\r\n                            return $t('enum.ProjectRelateType.' + ProjectRelateType['并列'])\r\n                        } else {\r\n                            if (d.target.id === nodeId) {\r\n                                return $t('enum.ProjectRelateType.' + ProjectRelateType['前置'])\r\n                            } else {\r\n                                return $t('enum.ProjectRelateType.' + ProjectRelateType['后续'])\r\n                            }\r\n                        }\r\n                    })\r\n            })\r\n    }\r\n\r\n    /* ----------------------------绑定画布拖拽放大缩小事件------------------------  */\r\n    function addBodyMouseOn() {\r\n        chart.svg().attr('style', 'cursor:pointer')\r\n\r\n        const zoomHandler = chart.getZoomHandler()\r\n\r\n        zoomHandler.scaleExtent([minScale, maxScale]).on('end', () => {\r\n            moving.value = false\r\n        })\r\n\r\n        //wheel.zoom设为null,可以禁用滚动缩放\r\n\r\n        /**手动计算以画布中心缩放 */\r\n        // manualZoom.value = function (type) {\r\n        //     const { x, y, k } = d3.zoomTransform(chart.svg().node())\r\n        //     // 以中心点缩放\r\n        //     const centerX = chart.width() / 2\r\n        //     const centerY = chart.height() / 2\r\n        //     let factor\r\n        //     if (type === 'add') {\r\n        //         factor = 1.25\r\n        //     } else {\r\n        //         factor = 0.8\r\n        //     }\r\n        //     const newK = k * factor\r\n\r\n        //     const newX = (x - centerX) * factor + centerX\r\n        //     const newY = (y - centerY) * factor + centerY\r\n        //     chart.svg().transition().call(zoomHandler.transform, d3.zoomIdentity.translate(newX, newY).scale(newK))\r\n        // }\r\n        /**使用scaleTo以画布中心缩放 */\r\n        manualZoom.value = function (type) {\r\n            // 以中心点缩放\r\n            const centerX = chart.width() / 2\r\n            const centerY = chart.height() / 2\r\n            let factor\r\n            if (type === 'add') {\r\n                factor = 1.25\r\n            } else {\r\n                factor = 0.8\r\n            }\r\n\r\n            chart.svg().transition().call(zoomHandler.scaleBy, factor, [centerX, centerY])\r\n        }\r\n\r\n        //缩放scale到1，并移动指定点位到中心\r\n        manualPosition.value = function ({ x, y }) {\r\n            const cx = chart.width() / 2\r\n            const cy = chart.height() / 2\r\n\r\n            // 目标：把 g 的缩放设为 1，并让 (x, y) 映射到画布中心 (cx, cy)\r\n            const target = d3.zoomIdentity\r\n                .translate(cx - x, cy - y) // 先平移（以 k=1 的坐标系）\r\n                .scale(1) // 缩放为 1\r\n\r\n            chart.svg().transition().call(zoomHandler.transform, target)\r\n        }\r\n    }\r\n    function addMouseOn() {\r\n        addNodeMouseOn()\r\n\r\n        addBodyMouseOn()\r\n    }\r\n\r\n    /* ----------------------------绑定tick事件------------------------  */\r\n    function addForceTick() {\r\n        force.on('tick', function () {\r\n            chart\r\n                .body()\r\n                .selectAll('line')\r\n                .attr('x1', (d) => d.source.x)\r\n                .attr('y1', (d) => d.source.y)\r\n                .attr('x2', (d) => d.target.x)\r\n                .attr('y2', (d) => d.target.y)\r\n\r\n            chart\r\n                .body()\r\n                .selectAll('g.line-text-box > text')\r\n                .attr('x', (d) => (d.source.x + d.target.x) / 2)\r\n                .attr('y', (d) => (d.source.y + d.target.y) / 2)\r\n                .attr('transform', (d) => {\r\n                    // const x = '90deg'\r\n                    const centerX = (d.source.x + d.target.x) / 2\r\n                    const centerY = (d.source.y + d.target.y) / 2\r\n                    const dx = d.source.x - d.target.x\r\n                    const dy = d.source.y - d.target.y\r\n                    let deg = 0\r\n                    if (dx === 0) {\r\n                        deg = dy > 0 ? -90 : 90\r\n                    } else {\r\n                        deg = (Math.atan(dy / dx) * 180) / Math.PI\r\n                    }\r\n                    return `rotate(${deg},${centerX},${centerY})`\r\n                })\r\n\r\n            chart\r\n                .body()\r\n                .selectAll('g.node-box')\r\n                .attr('transform', (d) => {\r\n                    return `translate(${d.x},${d.y})`\r\n                })\r\n        })\r\n        force.on('end', () => {\r\n            chart.zoomToFit()\r\n        })\r\n    }\r\n\r\n    chart.render = function () {\r\n        renderTitle()\r\n\r\n        renderNodes()\r\n\r\n        renderLinks()\r\n\r\n        renderLinkTexts()\r\n\r\n        addMouseOn()\r\n\r\n        addForceTick()\r\n\r\n        initNodeSelect()\r\n    }\r\n\r\n    chart.render()\r\n}\r\n\r\nfunction initNodeSelect() {\r\n    d3.select('#node-box' + originId.value)\r\n        .node()\r\n        .dispatchEvent(new MouseEvent('click'))\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.link-tool {\r\n    width: 40px;\r\n    right: 24px;\r\n    bottom: 24px;\r\n    box-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n.link-popover-box {\r\n    .el-form-item {\r\n        margin-bottom: -4px;\r\n    }\r\n    .el-form-item__label {\r\n        color: $gray-6;\r\n    }\r\n}\r\n// '#FFCD2A', '#BEE3FF', '#E7E7E7'\r\n.node-box[color='#FFCD2A'] {\r\n    :hover {\r\n        color: #ffc300;\r\n    }\r\n}\r\n.node-box[color='#BEE3FF'] {\r\n    :hover {\r\n        color: #a6d9ff;\r\n    }\r\n}\r\n.node-box[color='#E7E7E7'] {\r\n    :hover {\r\n        color: #d6d6d6;\r\n    }\r\n}\r\n</style>\r\n",
          "size": 26037,
          "encoding": "utf-8"
        }
      ]
    },
    {
      "name": "line",
      "type": "directory",
      "children": []
    },
    {
      "name": "map",
      "type": "directory",
      "children": [
        {
          "name": "geo",
          "type": "directory",
          "children": []
        },
        {
          "name": "base.vue",
          "type": "file",
          "content": "<template>\r\n    <div :id=\"id\"></div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport * as topojson from 'topojson'\r\nimport topoData from './geo/china_topo.json'\r\n\r\nimport Chart from '@/d3/chart.ts'\r\n\r\nconst currentMarker = ref({\r\n    name: '',\r\n})\r\nconst id = 'd3_svg_' + Math.floor(new Date().getTime() * Math.random())\r\n\r\nonMounted(() => {\r\n    initMap()\r\n})\r\n\r\nasync function initMap() {\r\n    /* ----------------------------配置参数------------------------  */\r\n    const config = {\r\n        id,\r\n        textColor: 'black',\r\n        title: '基础地图',\r\n        hoverColor: 'purple',\r\n    }\r\n\r\n    const chart = new Chart(config)\r\n\r\n    /* ----------------------------尺度转换------------------------  */\r\n    const projection = d3\r\n        .geoMercator()\r\n        .center([104, 38])\r\n        .scale(280)\r\n        .translate([chart.width() / 2, chart.height() / 2])\r\n\r\n    /* ----------------------------准备数据------------------------  */\r\n\r\n    const handleData = topojson.feature(topoData, topoData.objects['geo']).features\r\n\r\n    /* ----------------------------渲染地图轮廓------------------------  */\r\n    chart.renderMap = function () {\r\n        const path = d3.geoPath().projection(projection)\r\n\r\n        let map = chart.body().selectAll('path').data(handleData)\r\n\r\n        map.enter()\r\n            .append('path')\r\n            .attr('class', (d) => 'provinces ' + d.properties.name)\r\n            .merge(map)\r\n            .attr('d', path)\r\n            .attr('fill', (d, i) => chart._colors(i % 10))\r\n\r\n        map.exit().remove()\r\n    }\r\n\r\n    /* ----------------------------渲染省市中心点------------------------  */\r\n    chart.renderCenter = function () {\r\n        handleData.pop() //去除数组最后一个非省市元素\r\n\r\n        chart\r\n            .body()\r\n            .selectAll('circle')\r\n            .data(handleData)\r\n            .enter()\r\n            .append('circle')\r\n            .attr('class', (d) => 'center-' + d.properties.name)\r\n            .attr('cx', (d) => {\r\n                return projection(d.properties.center)[0]\r\n            })\r\n            .attr('cy', (d) => {\r\n                return projection(d.properties.center)[1]\r\n            })\r\n            .attr('r', 2)\r\n            .attr('fill', 'red')\r\n            .attr('stroke', 'black')\r\n    }\r\n\r\n    /* ----------------------------渲染图标题------------------------  */\r\n    chart.renderTitle = function () {\r\n        chart\r\n            .svg()\r\n            .append('text')\r\n            .classed('title', true)\r\n            .attr('x', chart.width() / 2)\r\n            .attr('y', 0)\r\n            .attr('dy', '2em')\r\n            .text(config.title)\r\n            .attr('fill', config.textColor)\r\n            .attr('text-anchor', 'middle')\r\n    }\r\n\r\n    /* ----------------------------绑定鼠标交互事件------------------------  */\r\n    chart.addMouseOn = function () {\r\n        //防抖函数\r\n        function debounce(fn, time) {\r\n            let timeId = null\r\n            return function () {\r\n                const context = this\r\n                const event = d3.event\r\n                timeId && clearTimeout(timeId)\r\n                timeId = setTimeout(function () {\r\n                    d3.event = event\r\n                    fn.apply(context, arguments)\r\n                }, time)\r\n            }\r\n        }\r\n\r\n        d3.selectAll('.provinces')\r\n            .on('mouseover', function (d) {\r\n                const e = d3.event\r\n                const position = d3.mouse(chart.svg().node())\r\n\r\n                d3.select(e.target).attr('fill', config.hoverColor)\r\n\r\n                chart\r\n                    .svg()\r\n                    .append('text')\r\n                    .classed('tip', true)\r\n                    .attr('x', position[0] + 5)\r\n                    .attr('y', position[1])\r\n                    .attr('fill', config.textColor)\r\n                    .text(d.properties.name)\r\n            })\r\n            .on('mouseleave', function (d, i) {\r\n                const e = d3.event\r\n\r\n                d3.select(e.target).attr('fill', chart._colors(i % 10))\r\n\r\n                d3.select('.tip').remove()\r\n            })\r\n            .on(\r\n                'mousemove',\r\n                debounce(function () {\r\n                    const position = d3.mouse(chart.svg().node())\r\n                    d3.select('.tip')\r\n                        .attr('x', position[0] + 5)\r\n                        .attr('y', position[1] - 5)\r\n                }, 6),\r\n            )\r\n    }\r\n\r\n    chart.render = function () {\r\n        chart.renderTitle()\r\n\r\n        chart.renderMap()\r\n\r\n        chart.renderCenter()\r\n\r\n        chart.addMouseOn()\r\n    }\r\n\r\n    chart.render()\r\n}\r\n</script>\r\n",
          "size": 4701,
          "encoding": "utf-8"
        },
        {
          "name": "layer.vue",
          "type": "file",
          "content": "<template>\r\n    <div class=\"relative h-full w-full\">\r\n        <div :id=\"id\" class=\"h-full w-full\"></div>\r\n\r\n        <div id=\"company-info-modal\" class=\"company-info-modal absolute z-30 p-1\" style=\"display: none\">\r\n            <div v-ell class=\"color-white\">{{ currentMarker.name }}</div>\r\n            <div class=\"p-a close-white\" style=\"right: 14px; top: 13px\" @click=\"closeTeamModal\"></div>\r\n        </div>\r\n        <svg class=\"hidden\">\r\n            <filter\r\n                x=\"-3.4%\"\r\n                y=\"-7.9%\"\r\n                width=\"106.6%\"\r\n                height=\"115.9%\"\r\n                filterUnits=\"objectBoundingBox\"\r\n                id=\"point-map-filter\">\r\n                <feGaussianBlur stdDeviation=\"12\" in=\"SourceAlpha\" result=\"shadowBlurInner1\"></feGaussianBlur>\r\n                <feOffset dx=\"0\" dy=\"0\" in=\"shadowBlurInner1\" result=\"shadowOffsetInner1\"></feOffset>\r\n                <feComposite\r\n                    in=\"shadowOffsetInner1\"\r\n                    in2=\"SourceAlpha\"\r\n                    operator=\"arithmetic\"\r\n                    k2=\"-1\"\r\n                    k3=\"1\"\r\n                    result=\"shadowInnerInner1\"></feComposite>\r\n                <feColorMatrix\r\n                    values=\"0 0 0 0 0.349019608   0 0 0 0 0.57254902   0 0 0 0 0.866666667  0 0 0 1 0\"\r\n                    type=\"matrix\"\r\n                    in=\"shadowInnerInner1\"></feColorMatrix>\r\n            </filter>\r\n        </svg>\r\n    </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport * as topojson from 'topojson'\r\nimport topoData from './geo/china_topo.json'\r\n\r\nimport Chart from '@/d3/chart.ts'\r\n\r\nlet projection\r\n\r\nconst currentMarker = ref({\r\n    name: '',\r\n})\r\nconst id = 'd3_svg_' + Math.floor(new Date().getTime() * Math.random())\r\nconst iconWidth = 3\r\n\r\nonMounted(() => {\r\n    initMap()\r\n})\r\nasync function initMap() {\r\n    const config = {\r\n        id,\r\n        margins: { top: 0, left: 0, bottom: 0, right: 0 },\r\n        textColor: 'black',\r\n        title: '多图层地图',\r\n        hoverColor: 'white',\r\n    }\r\n    const chart = new Chart(config)\r\n\r\n    /* ----------------------------尺度转换------------------------  */\r\n    const boxLatLng = topojson.bbox(topoData)\r\n    const center: [Number, Number] = [(boxLatLng[0] + boxLatLng[2]) / 2, (boxLatLng[1] + boxLatLng[3]) / 2]\r\n\r\n    /* ----------------------------准备数据------------------------  */\r\n\r\n    // 获取最外层轮廓路径的 GeoJSON\r\n    const geo_border = topojson.merge(topoData, topoData.objects.geo.geometries)\r\n\r\n    // 获取不包含最外层轮廓的其余边界路径的 GeoJSON，得到的是一个单一的路径，不存在边界重叠问题\r\n    const geo_interiors = topojson.mesh(topoData, topoData.objects.geo, (a, b) => a !== b)\r\n\r\n    //获取每个区域（省、市、区等）的独立 GeoJSON 数据\r\n    const geoData = topojson.feature(topoData, topoData.objects.geo)\r\n\r\n    //获取每个区域（省、市、区等）的独立 GeoJSON 数据\r\n    const handleData = geoData.features\r\n\r\n    // 获取边界值对应的投影中的xy\r\n    projection = d3\r\n        .geoMercator()\r\n        .rotate([0, 0, 0])\r\n        .angle(0)\r\n        .center(center)\r\n        .fitExtent(\r\n            [\r\n                [10, 10],\r\n                [chart.width() - 10, chart.height() - 10],\r\n            ],\r\n            geoData,\r\n        )\r\n\r\n    /* ----------------------------定义过滤器 ------------------------  */\r\n\r\n    /* ----------------------------渲染地图轮廓------------------------  */\r\n\r\n    let mapTop\r\n\r\n    //第一层（最底层），各区域面积，这一层仅仅渲染区域颜色，不包含边框\r\n    chart.mapArea = function (y, opacity) {\r\n        const path = d3.geoPath().projection(projection)\r\n\r\n        let mapArea = mapTop\r\n            .append('g')\r\n            .attr('transform', `translate(0,${y})`)\r\n            .attr('opacity', `${opacity}`)\r\n            .selectAll('path')\r\n            .data(handleData)\r\n            .enter()\r\n\r\n        mapArea\r\n            .append('path')\r\n            .attr('class', (d) => 'provinces ' + d.properties.name)\r\n            .merge(mapArea)\r\n            .attr('d', path)\r\n            .attr('stroke', 'none')\r\n            .attr('fill', '#0C2A55')\r\n        mapArea\r\n            .append('path')\r\n            .attr('class', (d) => 'provinces ' + d.properties.name)\r\n            .merge(mapArea)\r\n            .attr('d', path)\r\n            .attr('stroke', 'none')\r\n            .attr('fill', 'black')\r\n            .attr('filter', 'url(#point-map-filter)')\r\n\r\n        mapArea\r\n            .append('path')\r\n            .attr('class', (d) => 'provinces ' + d.properties.name)\r\n            .merge(mapArea)\r\n            .attr('d', path)\r\n            .attr('stroke', '#5992DD')\r\n            .attr('stroke-width', 1)\r\n            .attr('opacity', 1)\r\n            .attr('fill', 'none')\r\n        mapArea.exit().remove()\r\n    }\r\n    // 第二层，内部边界线路径\r\n    chart.mapInterior = function () {\r\n        const path = d3.geoPath().projection(projection)\r\n\r\n        let mapInterior = mapTop.append('g').append('path').datum(geo_interiors)\r\n\r\n        mapInterior.attr('d', path).attr('stroke', '#5992DD').attr('stroke-width', 1).attr('fill', 'none')\r\n    }\r\n    // 绘制第三层最外圈轮廓线\r\n    chart.mapOutline = function () {\r\n        const path = d3.geoPath().projection(projection)\r\n\r\n        let mapOutline = mapTop.append('g').append('path').datum(geo_border)\r\n\r\n        mapOutline\r\n            .attr('class', 'layer-outline ')\r\n            .merge(mapOutline)\r\n            .attr('d', path)\r\n            .attr('stroke', '#5992DD')\r\n            .attr('stroke-width', 2)\r\n            .attr('fill', 'none')\r\n    }\r\n    // 绘制第四层交互层\r\n    chart.mapOverlays = function () {\r\n        const path = d3.geoPath().projection(projection)\r\n\r\n        let mapOverlays = mapTop\r\n            .append('g')\r\n            .selectAll('g')\r\n            .data(handleData)\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', (d) => 'mapOverlays-' + d.properties.name)\r\n            .classed('pointer', false)\r\n            .classed('mapOverlays', true)\r\n            .attr('opacity', 0)\r\n\r\n        mapOverlays\r\n            .append('path')\r\n            .merge(mapOverlays)\r\n            .attr('d', path)\r\n            .attr('fill', 'rgba(252,174,99,1)')\r\n            .attr('stroke', 'rgba(255,153,0,1)')\r\n            .attr('stroke-width', 2)\r\n        mapOverlays\r\n            .append('path')\r\n            .merge(mapOverlays)\r\n            .attr('d', path)\r\n            .attr('fill', 'black')\r\n            .attr('stroke', 'none')\r\n            .attr('filter', 'url(#point-map-filter)')\r\n\r\n        mapOverlays.exit().remove()\r\n    }\r\n    chart.renderTop = function () {\r\n        mapTop = chart.body().append('g').attr('class', 'map-top')\r\n        chart.mapArea(8, 0.5)\r\n        chart.mapArea(7, 0.5)\r\n        chart.mapArea(6, 0.5)\r\n        chart.mapArea(5, 0.5)\r\n        chart.mapArea(4, 0.6)\r\n        chart.mapArea(3, 0.7)\r\n        chart.mapArea(2, 0.8)\r\n        chart.mapArea(1, 0.9)\r\n        chart.mapArea(0, 1)\r\n        chart.mapInterior()\r\n        chart.mapOutline()\r\n        chart.mapOverlays()\r\n    }\r\n    /* ----------------------------渲染省市中心点------------------------  */\r\n    chart.renderCenter = function () {\r\n        let iconArr = chart\r\n            .body()\r\n            .selectAll('map-icon')\r\n            .data(geoData.features)\r\n            .enter()\r\n            .append('g')\r\n            .attr('color', (d, i) => {\r\n                return '#00ffff'\r\n            }) // 给enter添加自身元素\r\n            .attr('class', (d, i) => 'map-icon-' + i)\r\n            .classed('map-icon', true)\r\n            .classed('pointer', true)\r\n            .attr('transform', (d) => {\r\n                let centroid = d3.geoCentroid(d)\r\n                let position = projection(centroid)\r\n                return `translate(${position[0]},${position[1]})`\r\n            })\r\n\r\n        iconArr\r\n            .append('circle')\r\n            .attr('fill', (d, i) => d3.schemeSet2[i % 8])\r\n            .attr('cx', iconWidth)\r\n            .attr('cy', iconWidth)\r\n            .attr('r', iconWidth)\r\n            .attr('transform', `translate(${-iconWidth},${-iconWidth})`)\r\n    }\r\n\r\n    /* ----------------------------渲染图标题------------------------  */\r\n    chart.renderTitle = function () {\r\n        chart\r\n            .svg()\r\n            .append('text')\r\n            .classed('title', true)\r\n            .attr('x', chart.width() / 2)\r\n            .attr('y', 0)\r\n            .attr('dy', '2em')\r\n            .text(config.title)\r\n            .attr('fill', config.textColor)\r\n            .attr('text-anchor', 'middle')\r\n    }\r\n\r\n    /* ----------------------------绑定鼠标交互事件------------------------  */\r\n    chart.addMouseOn = function () {\r\n        d3.selectAll('.map-icon')\r\n            .on('click', function (d) {})\r\n            .on('mouseenter', function (d) {\r\n                openIconModal(d)\r\n            })\r\n            .on('mouseleave', function (d) {\r\n                closeTeamModal(d)\r\n            })\r\n\r\n        d3.selectAll('.mapOverlays')\r\n            .on('mouseenter', function (d) {\r\n                openIconModal(d)\r\n            })\r\n            .on('mouseleave', function (d) {\r\n                closeTeamModal(d)\r\n            })\r\n    }\r\n\r\n    chart.render = function () {\r\n        chart.renderTitle()\r\n\r\n        chart.renderTop()\r\n\r\n        chart.renderCenter()\r\n        chart.addMouseOn()\r\n        chart.setZoom()\r\n    }\r\n\r\n    chart.render()\r\n}\r\n\r\nfunction openIconModal(d) {\r\n    d3.select('.mapOverlays-' + d.properties.name).attr('opacity', 1)\r\n\r\n    let centroid = d3.geoCentroid(d)\r\n    let position = projection(centroid)\r\n    d3.select('#company-info-modal').attr('style', `left:${position[0]}px;top:${position[1]}px;display:block`)\r\n\r\n    currentMarker.value.name = d.properties.name\r\n}\r\n\r\nfunction closeTeamModal(d) {\r\n    d3.select('.mapOverlays-' + d.properties.name).attr('opacity', 0)\r\n    d3.select(`#company-info-modal`).node().style.display = 'none'\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.company-info-modal {\r\n    position: absolute;\r\n    height: 30px;\r\n    background: linear-gradient(360deg, #0d2649, rgba(39, 72, 115, 0.7) 98%);\r\n    border: 1px solid #ff9900;\r\n    display: none;\r\n    pointer-events: none; //设置后，鼠标经过弹窗，不会影响svg图层的鼠标事件，即一个dom元素设置该属性后，不会再遮挡其他元素的鼠标事件\r\n}\r\n.close-white {\r\n    width: 26px;\r\n    height: 26px;\r\n    background: url('/src/assets/imgs/105.png') no-repeat center / 62%;\r\n}\r\n</style>\r\n",
          "size": 10667,
          "encoding": "utf-8"
        },
        {
          "name": "readme.md",
          "type": "file",
          "content": "[](https://datav.aliyun.com/portal/school/atlas/area_selector#&lat=30.3165)\r\n该地址中获取到的v3版本geojson地图数据混有大矩形，会导致地图显示异常，使用v2版本的数据能正常显示",
          "size": 214,
          "encoding": "utf-8"
        }
      ]
    },
    {
      "name": "pie",
      "type": "directory",
      "children": []
    },
    {
      "name": "chart.ts",
      "type": "file",
      "content": "import d3 from './d3.js'\r\nexport default class Chart {\r\n    constructor({ id, width, height, colors, margin }) {\r\n        this._box = d3.select('#' + id)\r\n\r\n        const boxDom = this._box.node()\r\n        this._width = width ?? boxDom.offsetWidth\r\n        this._height = height ?? boxDom.offsetHeight\r\n\r\n        this._id = id\r\n\r\n        this._scaleX = null\r\n        this._scaleY = null\r\n        this._colors = (i) => (colors ?? d3.schemeCategory10)[i]\r\n        this._svg = null\r\n        this._body = null\r\n        this._zoomHandler = null\r\n\r\n        this._margins = {\r\n            top: margin?.top ?? 10,\r\n            left: margin?.left ?? 10,\r\n            right: margin?.right ?? 10,\r\n            bottom: margin?.bottom ?? 10,\r\n        }\r\n        this.renderChart()\r\n    }\r\n\r\n    id() {\r\n        return this._id\r\n    }\r\n\r\n    width() {\r\n        return this._width\r\n    }\r\n\r\n    height() {\r\n        return this._height\r\n    }\r\n\r\n    margin() {\r\n        return this._margins\r\n    }\r\n\r\n    // scaleX(x) {\r\n    //     if (arguments.length === 0) return this._scaleX\r\n    //     this._scaleX = x\r\n    //     return this\r\n    // }\r\n\r\n    // scaleY(y) {\r\n    //     if (arguments.length === 0) return this._scaleY\r\n    //     this._scaleY = y\r\n    //     return this\r\n    // }\r\n\r\n    svg() {\r\n        return this._svg\r\n    }\r\n\r\n    body() {\r\n        return this._body\r\n    }\r\n\r\n    box() {\r\n        return this._box\r\n    }\r\n    getBodyWidth() {\r\n        const width = this._width - this._margins.left - this._margins.right\r\n        return width > 0 ? width : 0\r\n    }\r\n\r\n    getBodyHeight() {\r\n        const height = this._height - this._margins.top - this._margins.bottom\r\n        return height > 0 ? height : 0\r\n    }\r\n\r\n    renderChart() {\r\n        if (!this._box) {\r\n            this._box = d3.select('#' + this._id)\r\n        }\r\n\r\n        if (!this._svg) {\r\n            this._svg = this._box.append('svg')\r\n        }\r\n        this._svg.attr('width', this._width).attr('height', this._height)\r\n\r\n        if (!this._body) {\r\n            this._body = this._svg.append('g').attr('class', 'body')\r\n        }\r\n\r\n        return this\r\n    }\r\n\r\n    setZoom(handler) {\r\n        if (handler) {\r\n            this._zoomHandler = handler\r\n            return\r\n        }\r\n        this._zoomHandler = d3\r\n            .zoom() // 创建缩放行为\r\n            // .filter(() => isFull.value) // 可以处理zoomHandler何时生效\r\n            .wheelDelta(() => {\r\n                return d3.event.deltaY * -0.002\r\n            })\r\n            .on('zoom', () => {\r\n                this._body.attr('transform', d3.event.transform)\r\n            })\r\n        this._svg.call(this._zoomHandler)\r\n    }\r\n    getZoomHandler() {\r\n        if (!this._zoomHandler) {\r\n            this.setZoom()\r\n        }\r\n        return this._zoomHandler\r\n    }\r\n\r\n    zoomToFit() {\r\n        const bbox = this._body.node().getBBox()\r\n        const contentWidth = bbox.width || 1\r\n        const contentHeight = bbox.height || 1\r\n\r\n        // 仅在计算 scale 时扣除 padding，其他逻辑不变\r\n        const viewW = this.getBodyWidth()\r\n        const viewH = this.getBodyHeight()\r\n\r\n        const scale = Math.min(viewW / contentWidth, viewH / contentHeight)\r\n\r\n        //缩放居中的，左边界的坐标应该为留白部分的一半 Lx = (viewW - contentW * scale) / 2\r\n        //而Lx应该是通过仿射变换工具得来 scale * xMin + tx = Lx\r\n        //故解得平移参数tx =  (viewW - contentW * scale) / 2  + padding - scale * xMin\r\n\r\n        const translate = [\r\n            (viewW - contentWidth * scale) / 2 + this.margin().left - bbox.x * scale,\r\n            (viewH - contentHeight * scale) / 2 + this.margin().top - bbox.y * scale,\r\n        ]\r\n\r\n        // 应用自动缩放\r\n        this._svg\r\n            .transition()\r\n            .call(this.getZoomHandler().transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale))\r\n    }\r\n}\r\n",
      "size": 3933,
      "encoding": "utf-8"
    },
    {
      "name": "svgs.ts",
      "type": "file",
      "content": "// @ts-ignore\r\nimport { debounce } from 'lodash-es'\r\n// @ts-ignore\r\n\r\nfunction computedSize(): number {\r\n    const docEle = document.documentElement\r\n    const screenRatioByDesign = 16 / 9\r\n    const offsetWidth = docEle.offsetWidth || docEle.clientWidth\r\n    const offsetHeight = docEle.offsetHeight || docEle.clientHeight\r\n    const screenRatio = offsetWidth / offsetHeight\r\n    return (offsetWidth / 1920) * (screenRatio > screenRatioByDesign ? screenRatioByDesign / screenRatio : 1)\r\n}\r\n\r\nclass Watcher {\r\n    call: Function\r\n    id: string\r\n    allSize: number[]\r\n    dom: Element | null\r\n    constructor(call: Function, id: string, allSize: number[]) {\r\n        this.call = call\r\n        this.id = id\r\n        this.allSize = allSize\r\n        this.dom = null\r\n    }\r\n    draw() {\r\n        Promise.resolve().then(() => {\r\n            const sizeRatio: number = computedSize()\r\n            const newAllSize: Array<number> = this.allSize.map((item: number) => {\r\n                return <number>sizeRatio * item\r\n            })\r\n            this.call(this.id, ...newAllSize)\r\n        })\r\n    }\r\n    remove() {\r\n        if (!this.dom) {\r\n            this.dom = document.querySelector('#' + this.id)\r\n        }\r\n        if (this.dom) {\r\n            this.dom.innerHTML = ''\r\n            return true\r\n        } else {\r\n            return false\r\n        }\r\n    }\r\n}\r\n\r\nconst dep = new Map()\r\nconst notice = debounce(1000, false, () => {\r\n    dep.forEach((item, key) => {\r\n        const result = item.remove()\r\n        if (result) {\r\n            item.draw()\r\n        } else {\r\n            dep.delete(key)\r\n        }\r\n    })\r\n})\r\nfunction svgInit(call: Function, id: string, allSize: number[]) {\r\n    const watcher = new Watcher(call, id, allSize)\r\n    watcher.draw()\r\n    dep.set(id, watcher)\r\n}\r\n\r\nconst resizeFunction = () => {\r\n    dep.forEach((item, key) => {\r\n        const result = item.remove()\r\n        if (!result) {\r\n            dep.delete(key)\r\n        }\r\n    })\r\n    notice()\r\n}\r\n\r\nwindow.addEventListener('resize', resizeFunction)\r\nexport default svgInit\r\n",
      "size": 2063,
      "encoding": "utf-8"
    }
  ]
}